name: Continuous Integration

on:
  push:
    branches:
      - pipeline
  pull_request:
    branches:
      - pipeline

jobs:
  build_and_analyze:
    name: Build and Analyze
    runs-on: ubuntu-latest

    steps:
      # Langkah 1: Mengunduh kode dari repositori
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # Diperlukan agar SonarScanner bisa menganalisis riwayat Git

      # Langkah 2: Menyiapkan lingkungan Node.js
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 18 

      # Langkah 3: Menginstal dependensi proyek
      - name: Install Dependencies
        run: npm install

      # Langkah 4: Membangun (build) aplikasi
      - name: Build Application
        run: npm run build

      # Langkah 5: Menjalankan SonarCloud Scan
      - name: SonarCloud Scan
        uses: SonarSource/sonarcloud-github-action@master
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} 
          SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }} 
